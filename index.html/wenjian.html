<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GLM模型测试</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; /* 防止页面滚动条 */
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <!-- 加载提示信息 -->
    <div id="loading" style="position: absolute; top: 20px; left: 20px; color: white; font-family: Arial; z-index: 100;">
        正在加载模型...
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. 创建场景、相机、渲染器
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x333333); // 设置深色背景便于观察

        const camera = new THREE.PerspectiveCamera(
            75, 
            window.innerWidth / window.innerHeight, 
            0.1, 
            1000
        );
        camera.position.set(2, 2, 5); // 调整到一个更好的观察位置
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio); // 适配高清屏
        document.body.appendChild(renderer.domElement);

        // 2. 添加轨道控制器（用鼠标拖拽旋转/缩放模型）
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // 添加阻尼感，更平滑
        controls.dampingFactor = 0.05;

        // 3. 添加光源（非常重要！没有光源模型是黑色的）
        // 环境光
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        // 平行光（模拟阳光）
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7);
        scene.add(directionalLight);

        // 4. 添加坐标轴辅助（便于理解3D空间）
        const axesHelper = new THREE.AxesHelper(3);
        scene.add(axesHelper);

        // 5. 加载GLB模型
        const loader = new GLTFLoader();
        const loadingElement = document.getElementById('loading');
        
        loader.load(
            // ⚠️ 模型路径：确保 `yueqiu.glb` 文件放在与HTML文件同级的 `models` 文件夹中
            './models/yueqiu.glb',
            
            // 加载成功回调
            (gltf) => {
                console.log('✅ 模型加载成功！', gltf);
                loadingElement.textContent = '模型加载成功！';
                
                const model = gltf.scene;
                
                // 调整模型位置到场景中心
                model.position.set(0, 0, 0);
                
                // 计算模型大小，自动调整相机
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                // 确保相机能看到整个模型
                const maxDim = Math.max(size.x, size.y, size.z);
                camera.position.copy(center);
                camera.position.z += maxDim * 1.5;
                camera.lookAt(center);
                
                scene.add(model);
                
                // 3秒后隐藏加载提示
                setTimeout(() => {
                    loadingElement.style.display = 'none';
                }, 3000);
            },
            
            // 加载进度回调
            (xhr) => {
                const percent = Math.round((xhr.loaded / xhr.total) * 100);
                loadingElement.textContent = `正在加载模型... ${percent}%`;
                console.log(`加载进度: ${percent}%`);
            },
            
            // 加载失败回调
            (error) => {
                console.error('❌ 模型加载失败:', error);
                loadingElement.innerHTML = `
                    模型加载失败！<br>
                    可能原因：<br>
                    1. 模型文件路径不正确<br>
                    2. 模型文件损坏<br>
                    3. 服务器不允许加载GLB文件<br>
                    <small>检查控制台(F12)获取详细信息</small>
                `;
                loadingElement.style.color = '#ff6666';
            }
        );

        // 6. 窗口大小调整响应
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 7. 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // 更新轨道控制器
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
